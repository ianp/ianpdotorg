
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Embedding Clojure in an Existing Application - Digital Magpie</title>
  <meta name="author" content="Ian Phillips">

  
  <meta name="description" content="I’ve been taking a look at Clojure lately, as a JVM friendly
flavour of Lisp I’ve got to say it looks pretty interesting. One problem
that I’ve had &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://ianp.org/2009/04/27/embedding-clojure-in-an-existing-application">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Digital Magpie" type="application/atom+xml">
  <!--Fonts from Google's Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>


<script type="text/javascript">
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '4fa7e376613f5d2014000195');
    t.src = '//secure.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>




  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-266232-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Digital Magpie</a></h1>
  
    <h2>Ooh, ooh, look - shiny things!</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:ianp.org" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul role=main-navigation>
  <li><a href="/">Blog</a></li>
  <li><a href="/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Embedding Clojure in an Existing Application</h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-04-27T10:57:37+02:00" pubdate data-updated="true">Apr 27<span>th</span>, 2009</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I’ve been taking a look at <a href="http://www.clojure.org/">Clojure</a> lately, as a JVM friendly
flavour of Lisp I’ve got to say it looks pretty interesting. One problem
that I’ve had though is that all of the documentation out there (of
which there’s very little, to be honest) seems to assume that you’ll be
writing/running a pure Clojure program as you main application. There’s
plenty of information about calling Java code from Clojure programs, and
<em>some</em> information about extending Java classes and interfaces with
Clojure code, but nothing about getting the two talking together at
runtime. So here’s how it’s done.</p>

<p>First off you need to set up the
symbols and namespaces that you are going to need to start up a clojure
environment.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">Symbol</span> <span class="n">main</span> <span class="o">=</span> <span class="n">Symbol</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">&quot;main&quot;</span><span class="o">);</span>
</span><span class="line"><span class="n">Symbol</span> <span class="n">clojureMain</span> <span class="o">=</span> <span class="n">Symbol</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">&quot;clojure.main&quot;</span><span class="o">);</span>
</span><span class="line"><span class="n">Symbol</span> <span class="n">user</span> <span class="o">=</span> <span class="n">Symbol</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">&quot;user&quot;</span><span class="o">);</span>
</span><span class="line"><span class="n">Symbol</span> <span class="n">require</span> <span class="o">=</span> <span class="n">Symbol</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">&quot;require&quot;</span><span class="o">);</span>
</span><span class="line"><span class="n">Namespace</span> <span class="n">userNS</span> <span class="o">=</span> <span class="n">Namespace</span><span class="o">.</span><span class="na">findOrCreate</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
</span><span class="line"><span class="n">Namespace</span> <span class="n">clojureMainNS</span> <span class="o">=</span> <span class="n">Namespace</span><span class="o">.</span><span class="na">findOrCreate</span><span class="o">(</span><span class="n">clojureMain</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Once you have these you can <em>require</em> the clojure main namespace, this
is the same one that is used to run scripts or start a REPL from the
comand line.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">Var</span><span class="o">.</span><span class="na">intern</span><span class="o">(</span><span class="n">RT</span><span class="o">.</span><span class="na">CLOJURE_NS</span><span class="o">,</span> <span class="n">require</span><span class="o">).</span><span class="na">invoke</span><span class="o">(</span><span class="n">clojureMain</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Then, and this is the bit that I had trouble working out, you need to
bind your application’s domain model (or at least those bits of it that
you want to expose) into the <em>user</em> namespace in Clojure.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="k">for</span> <span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">global</span> <span class="o">:</span> <span class="n">globals</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
</span><span class="line">    <span class="n">String</span> <span class="n">key</span> <span class="o">=</span> <span class="n">global</span><span class="o">.</span><span class="na">getKey</span><span class="o">();</span>
</span><span class="line">    <span class="n">Object</span> <span class="n">value</span> <span class="o">=</span> <span class="n">global</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
</span><span class="line">    <span class="n">Var</span><span class="o">.</span><span class="na">intern</span><span class="o">(</span><span class="n">userNS</span><span class="o">,</span> <span class="n">Symbol</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">key</span><span class="o">),</span> <span class="n">value</span><span class="o">);</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Finally you’re ready to grab the <code>main</code> method and run it.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">Var</span><span class="o">.</span><span class="na">intern</span><span class="o">(</span><span class="n">clojureMainNS</span><span class="o">,</span> <span class="n">main</span><span class="o">).</span><span class="na">applyTo</span><span class="o">(</span><span class="n">RT</span><span class="o">.</span><span class="na">seq</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[</span><span class="mi">0</span><span class="o">]));</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The emtpy string array here is emulating an emty sargument list at the
command line. Some things to note here: you need to <em>intern</em> vars
before you can use them, even for core library features like
<em>require</em>, this surprised me at first but when you remember that most
Lisps are built around a very small core of special forms with
everything else defined in Lisp, it makes some sense.</p>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">ianp</span></span>

      








  


<time datetime="2009-04-27T10:57:37+02:00" pubdate data-updated="true">Apr 27<span>th</span>, 2009</time>
      

<span class="categories">
  
    <a class='category' href='/categories/clojure/'>Clojure</a>, <a class='category' href='/categories/java/'>Java</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2009/04/23/guice-development-stages" title="Previous Post: Guice Development Stages">&laquo; Guice Development Stages</a>
      
      
        <a class="basic-alignment right" href="/2009/04/28/embedding-clojure-part-2" title="Next Post: Embedding Clojure (part 2)">Embedding Clojure (part 2) &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2013/01/08/for-some-definition-of-easily">For Some Definition of Easily</a>
      </li>
    
      <li class="post">
        <a href="/2012/12/17/i-remain-a-free-man">I Remain a Free Man</a>
      </li>
    
      <li class="post">
        <a href="/2012/11/05/stroke-me-gently">Stroke Me Gently</a>
      </li>
    
      <li class="post">
        <a href="/2012/10/31/rearranging-the-apples">Rearranging the Apples</a>
      </li>
    
      <li class="post">
        <a href="/2012/10/30/vlc-versions">VLC Versions</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/ianp">@ianp</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'ianp',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2003&ndash;2013 &mdash; Ian Phillips &mdash;
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a>, <a href="http://github.com/">GitHub</a>, and too much coffee.</span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'ianpdotorg';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
