
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Digital Magpie</title>
  <meta name="author" content="Ian Phillips">

  
  <meta name="description" content="Just in time for the weekend, the SF NoSQL community have put up a collection of talks and slides from their recent get together. I’ll have more to &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://ianp.github.com/ianpdotorg/page/4">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Digital Magpie" type="application/atom+xml">
  <!--Fonts from Google's Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>


<script type="text/javascript">
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '4fa7e376613f5d2014000195');
    t.src = '//secure.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>




  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Digital Magpie</a></h1>
  
    <h2>Ooh, ooh, look - shiny things!</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:ianp.github.com/ianpdotorg" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul role=main-navigation>
  <li><a href="/">Blog</a></li>
  <li><a href="/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/01/08/sql-just-say-no">SQL: Just Say No!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-01-08T16:29:30+01:00" pubdate data-updated="true">Jan 8<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Just in time for the weekend, the SF <a href="http://en.wikipedia.org/wiki/NoSQL">NoSQL</a> community have put up a <a href="http://blog.oskarsson.nu/2009/06/nosql-debrief.html">collection of talks and slides</a> from their recent get together. I’ll have more to say after I’ve had a chance to look these over…</p>

<p><em>Update:</em> not actually a new set of talks, these have been online for about 6 months now, but it’s the first time that I’ve seen them…</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/01/07/prevalent-synchronicity">Prevalent Synchronicity</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-01-07T13:23:33+01:00" pubdate data-updated="true">Jan 7<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Maybe it’s just an idea whose time has come, but in the past few days there’ve been 2 prevalent database systems announced for <a href="http://clojure.org/">Clojure</a>: <a href="http://fleetdb.org/">FleetDB</a> and <a href="http://github.com/SergeyDidenko/Simple-Persistence-for-Clojure">Persister</a>.</p>

<h4 id="prevalent-databases">Prevalent Databases</h4>

<p>The idea behind prevalent databases has been around for a while being, if not ‘popularised’ exactly, at least pushed by the guys behind <a href="http://www.prevayler.org/">Prevayler</a>. Here’s how they describe them:</p>

<blockquote>
  <p>Prevayler is an open source object persistence library for Java. It is an implementation of the Prevalent System design pattern, in which business objects are kept live in memory and transactions are journaled for system recovery.</p>
</blockquote>

<h4 id="fleet-db">Fleet DB</h4>

<p>While <a href="http://twitter.com/mmcgrana">Mark McGranaghan</a>’s Fleet DB doesn’t use the term prevalent database, but right now that’s basically what it is. The core of Fleet DB is a Clojure based append-only log based database; it provides a native clojure query language (with built in query optimiser), schema-less records, indexes, and a server with a JSON based network protocol.</p>

<p>For a new new project Fleet DB also has a good set of documentation and it sounds like Mark has some big plans for it in the future. As an added benefit there are also clients for the network protocol in languages other than Clojure (Ruby officially, and a set of Python bindings in development).</p>

<h4 id="persister">Persister</h4>

<p>Sergey Didenko’s <a href="http://github.com/SergeyDidenko/Simple-Persistence-for-Clojure">Simple Persistence for Clojure</a> project is a much less ambitious offering, but with the really cool feature of being a single (255 line, ~11KB) file that you could just drop into your project and start using - that’s pretty lightweight! From the read me file:</p>

<blockquote>
  <p>Simple Persistence for Clojure is a journal-based persistence library for Clojure programs. It follows “Prevalent system” design pattern.</p>
</blockquote>

<p>The intended usage is assist you in making a prevalent system. Thus you work with your in-memory data and wrap every writing call into one of <code>(apply-transaction*)</code> macros. A nice feature is that the log files are just Clojure code: transactions are logged as a valid Clojure code, so they are easy to read and run separately.</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/01/06/squeeze">Squeeze!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-01-06T18:38:16+01:00" pubdate data-updated="true">Jan 6<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>One of the neat features of <a href="http://clojure.org/">Clojure</a> is the <a href="http://clojure.org/sequences">sequence</a> abstraction — it makes solving a whole host of data processing tasks much easier, simply get you data into a sequence and you’ve got a huge toolbox available to work on it. Of course being a guy I’m firmly of the belief that more tools are better, with that in mind let’s add another one to our toolbox. Given a sequence the squeeze function returns another sequence with any adjacent items which match a supplied predicate merged together using a supplied function. It’s probably easier to illustrate by example, suppose I have a sequence of strings and I want to merge them together when the trailing string starts with whitespace, I can squeeze them like this:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="clj"><span class="line"><span class="p">(</span><span class="nf">squeeze</span> <span class="o">#</span><span class="p">(</span><span class="nv">and</span> <span class="nv">%2</span> <span class="p">(</span><span class="nb">re-matches </span><span class="o">#</span><span class="s">&quot;\A\s.*&quot;</span> <span class="nv">%2</span><span class="p">))</span>
</span><span class="line">         <span class="o">#</span><span class="p">(</span><span class="nv">apply</span> <span class="nv">str</span> <span class="p">(</span><span class="nb">apply </span><span class="nv">concat</span> <span class="nv">%&amp;</span><span class="p">))</span>
</span><span class="line">         <span class="p">[</span><span class="s">&quot;hello&quot;</span> <span class="s">&quot; world.&quot;</span> <span class="s">&quot;foo&quot;</span> <span class="s">&quot; bar&quot;</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Another example, given a sequence of characters (read from an <code>InputStream</code> for example), I could group them into words by squeezing then thusly (the first line is just to remind you that calling <code>seq</code> on a string produces a sequence of characters):</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="clj"><span class="line"><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nb">seq </span><span class="s">&quot;Cheers, chars!&quot;</span><span class="p">)</span>
</span><span class="line"><span class="p">(</span><span class="sc">\C</span> <span class="sc">\h</span> <span class="sc">\e</span> <span class="sc">\e</span> <span class="sc">\r</span> <span class="sc">\s</span> <span class="err">\</span><span class="o">,</span> <span class="sc">\space</span> <span class="sc">\c</span> <span class="sc">\h</span> <span class="sc">\a</span> <span class="sc">\r</span> <span class="sc">\s</span> <span class="sc">\!</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nb">map </span><span class="nv">str/trim</span>
</span><span class="line">         <span class="p">(</span><span class="nf">squeeze</span> <span class="o">#</span><span class="p">(</span><span class="nv">and</span> <span class="nv">%2</span> <span class="p">(</span><span class="nb">not= </span><span class="sc">\space</span> <span class="nv">%2</span><span class="p">))</span>
</span><span class="line">                  <span class="o">#</span><span class="p">(</span><span class="nv">apply</span> <span class="nv">str</span> <span class="p">(</span><span class="nb">apply </span><span class="nv">concat</span> <span class="nv">%&amp;</span><span class="p">))</span>
</span><span class="line">                   <span class="p">(</span><span class="nb">seq </span><span class="s">&quot;I&#39;m sorry Dave, I can&#39;t let you do that.&quot;</span><span class="p">)))</span>
</span><span class="line"><span class="p">(</span><span class="s">&quot;I&#39;m&quot;</span> <span class="s">&quot;sorry&quot;</span> <span class="s">&quot;Dave,&quot;</span> <span class="s">&quot;I&quot;</span> <span class="s">&quot;can&#39;t&quot;</span> <span class="s">&quot;let&quot;</span> <span class="s">&quot;you&quot;</span> <span class="s">&quot;do&quot;</span> <span class="s">&quot;that.&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>So how does it work? Well, here’s the interface:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="clj"><span class="line"><span class="p">(</span><span class="k">defn </span><span class="nv">squeeze</span>
</span><span class="line">  <span class="p">[</span><span class="nv">pred</span> <span class="nv">merge-fn</span> <span class="nv">coll</span><span class="p">]</span>
</span><span class="line">  <span class="p">(</span><span class="nf">squeeze-</span> <span class="nv">pred</span> <span class="nv">merge-fn</span> <span class="nv">coll</span> <span class="nv">nil</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>And here’s the actual function that does the work, it’s declared private
because I don’t want to expose the matched parameter to the outside
world.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="clj"><span class="line"><span class="p">(</span><span class="k">defn- </span><span class="nv">squeeze-</span>
</span><span class="line">  <span class="p">([</span><span class="nv">pred</span> <span class="nv">merge-fn</span> <span class="nv">coll</span> <span class="nv">matched</span><span class="p">]</span>
</span><span class="line">    <span class="p">(</span><span class="nf">lazy-seq</span>
</span><span class="line">      <span class="p">(</span><span class="nb">when-let </span><span class="p">[</span><span class="nv">s</span> <span class="p">(</span><span class="nb">seq </span><span class="nv">coll</span><span class="p">)]</span>
</span><span class="line">        <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">f</span> <span class="p">(</span><span class="nb">first </span><span class="nv">s</span><span class="p">)</span>
</span><span class="line">              <span class="nv">s</span> <span class="p">(</span><span class="nb">second </span><span class="nv">s</span><span class="p">)</span>
</span><span class="line">              <span class="nv">rest</span> <span class="p">(</span><span class="nb">rest </span><span class="nv">coll</span><span class="p">)]</span>
</span><span class="line">          <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">pred</span> <span class="nv">f</span> <span class="nv">s</span><span class="p">)</span>
</span><span class="line">            <span class="p">(</span><span class="nf">squeeze-</span> <span class="nv">pred</span> <span class="nv">merge-fn</span> <span class="nv">rest</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">f</span> <span class="nv">matched</span><span class="p">))</span>
</span><span class="line">            <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">next</span> <span class="p">(</span><span class="k">if </span><span class="nv">matched</span> <span class="p">(</span><span class="nf">merge-fn</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">f</span> <span class="p">(</span><span class="nb">reverse </span><span class="nv">matched</span><span class="p">)))</span> <span class="nv">f</span><span class="p">)]</span>
</span><span class="line">              <span class="p">(</span><span class="nb">cons </span><span class="nv">next</span> <span class="p">(</span><span class="nf">squeeze-</span> <span class="nv">pred</span> <span class="nv">merge-fn</span> <span class="nv">rest</span> <span class="nv">nil</span><span class="p">)))))))))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>I should probably point out that all of this playing around with
sequences was inspired by <a href="http://fulldisclojure.blogspot.com/">Sean Devlin</a>’s <a href="http://fulldisclojure.blogspot.com/2010/01/12-fn-proposal-same-multisame.html">excellent proposal</a>
for some new sequence functions for Clojure 1.2. The full code for this
is available <a href="/code/2010/01/squeeze.clj">here</a> (it’s just the above, but with an added doc
comment on the <code>squeeze</code> function definition).</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/01/02/working-with-java-arrays">Working With Java Arrays</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-01-02T14:23:44+01:00" pubdate data-updated="true">Jan 2<span>nd</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>One improvement that I’d like to see in Clojure is more examples in the doc strings (or maybe in a separate <code>:example</code> metadata item). Still, nothing to stop me building up a set of my own. So, here are some simple examples of working with Java arrays in Clojure… Given some sample data:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="clj"><span class="line"><span class="p">(</span><span class="k">def </span><span class="nv">my-list</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">))</span>
</span><span class="line"><span class="p">(</span><span class="k">def </span><span class="nv">my-vector</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">])</span>
</span><span class="line"><span class="p">(</span><span class="k">def </span><span class="nv">my-map</span> <span class="p">{</span><span class="nv">:a</span> <span class="s">&quot;apple&quot;</span> <span class="nv">:b</span> <span class="s">&quot;banana&quot;</span> <span class="nv">:c</span> <span class="s">&quot;chopped liver&quot;</span><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>To convert to Java arrays:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="clj"><span class="line"><span class="p">(</span><span class="nb">to-array </span><span class="nv">my-list</span><span class="p">)</span>
</span><span class="line"><span class="o">#</span>
</span><span class="line"><span class="p">(</span><span class="nb">to-array </span><span class="nv">my-vector</span><span class="p">)</span>
</span><span class="line"><span class="o">#</span>
</span><span class="line"><span class="p">(</span><span class="nb">to-array </span><span class="nv">my-map</span><span class="p">)</span>
</span><span class="line"><span class="o">#</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Note that this always returns <code>Object[]</code> regardless of the contents of the collection. Note also that the map isn’t flattened (the <code>pp</code> function used here is in <code>clojure.contrib.pprint</code>):</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="clj"><span class="line"><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">pp</span><span class="p">)</span>
</span><span class="line"><span class="p">[[</span><span class="nv">:a</span> <span class="s">&quot;apple&quot;</span><span class="p">]</span><span class="o">,</span> <span class="p">[</span><span class="nv">:b</span> <span class="s">&quot;banana&quot;</span><span class="p">]</span><span class="o">,</span> <span class="p">[</span><span class="nv">:c</span> <span class="s">&quot;chopped liver&quot;</span><span class="p">]]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>If the array is 2-dimensional there is a corresponding function:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="clj"><span class="line"><span class="nv">user=&gt;</span> <span class="p">(</span><span class="k">def </span><span class="nv">my-vec-2d</span> <span class="p">[[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">]</span> <span class="p">[</span><span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span><span class="p">]</span> <span class="p">[</span><span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span><span class="p">]])</span>
</span><span class="line"><span class="o">#</span><span class="ss">&#39;user/my-vec-2d</span>
</span><span class="line"><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nb">to-array-2d </span><span class="nv">my-vec-2d</span><span class="p">)</span>
</span><span class="line"><span class="o">#</span>
</span><span class="line"><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">pp</span><span class="p">)</span>
</span><span class="line"><span class="p">[[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">,</span> <span class="p">[</span><span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">6</span><span class="p">]</span><span class="o">,</span> <span class="p">[</span><span class="mi">7</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">9</span><span class="p">]]</span>
</span><span class="line"><span class="nv">nil</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>If you need to use a specific type of array (e.g. to pass a <code>String[]</code> into a Java method) or need to use an array with more than 3 dimensions it’s a little trickier:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
</pre></td><td class="code"><pre><code class="clj"><span class="line"><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nb">into-array </span><span class="nv">my-list</span><span class="p">)</span>
</span><span class="line"><span class="o">#</span>
</span><span class="line"><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">pp</span><span class="p">)</span>
</span><span class="line"><span class="p">[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="p">]</span>
</span><span class="line"><span class="nv">nil</span>
</span><span class="line"><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nb">into-array </span><span class="nv">my-vector</span><span class="p">)</span>
</span><span class="line"><span class="o">#</span>
</span><span class="line"><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">pp</span><span class="p">)</span>
</span><span class="line"><span class="p">[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="p">]</span>
</span><span class="line"><span class="nv">nil</span>
</span><span class="line"><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nb">into-array </span><span class="nv">my-map</span><span class="p">)</span>
</span><span class="line"><span class="o">#</span>
</span><span class="line"><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nb">into-array </span><span class="p">(</span><span class="nb">vals </span><span class="nv">my-map</span><span class="p">))</span>
</span><span class="line"><span class="o">#</span>
</span><span class="line"><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">pp</span><span class="p">)</span>
</span><span class="line"><span class="p">[</span><span class="s">&quot;apple&quot;</span><span class="o">,</span> <span class="s">&quot;banana&quot;</span><span class="o">,</span> <span class="s">&quot;chopped liver&quot;</span><span class="p">]</span>
</span><span class="line"><span class="nv">nil</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>There, that should serve as a handy reference for myself for when I’m feeling forgetful…</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/12/29/nexus-one-launch-even-on-jan-5">Nexus One Launch Even on Jan 5?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-29T19:13:26+01:00" pubdate data-updated="true">Dec 29<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote>
  <p>This just in: <a href="http://www.google.com/">Google</a> will host an <a href="http://www.android.com/">Android</a> press gathering
at its global HQ on Jan. 5 ….</p>
</blockquote>

<p>Presumably, the event will have something
to do with the company’s Nexus One, an Android phone that Google plans
to sell on its own Web site and perhaps through T-Mobile as well.</p>

<p>Via <a href="http://digitaldaily.allthingsd.com/20091229/google-announces-jan-5-android-event/">Digital Daily</a></p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/12/28/why-everything-is-a-file">Why Everything Is a File</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-28T17:54:29+01:00" pubdate data-updated="true">Dec 28<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>One of the <a href="http://en.wikipedia.org/wiki/Unix_architecture">distinguishing characteristics of Unix</a> is the
philosophy that “everything is a file” (taken even further in
<a href="http://en.wikipedia.org/wiki/Linux">Linux</a> and <a href="http://plan9.bell-labs.com/plan9/">Plan 9</a>). Reading the interview with <a href="http://en.wikipedia.org/wiki/Ken_Thompson">Ken Thompson</a> in <a href="http://www.codersatwork.com/">Coders at Work</a> (page 465) sheds some light on why
this is the case:</p>

<blockquote>
  <p><strong>Seibel:</strong> So you basically wrote an OS so you’d
have a better environment to test your file system.
<strong>Thompson:</strong> Yes. Halfway through there that I realized it was a real time-sharing
system. I was writing the shell to drive the file system. And then I was
writing a couple other programs that drove the file system. And right
about there I said, “All I need is an editor and I’ve got an operating
system.”</p>
</blockquote>

<p>So Unix started life as a glorified test harness for Ken’s file system! Amusing…</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/12/26/the-c-programming-language">The C Programming Language</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-26T19:07:09+01:00" pubdate data-updated="true">Dec 26<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote>
  <p>C functions may be used recursively; that is, a function may call
itself either directly or indirectly. Uninquiring souls may take this as
just another peculiarity of those C folk, of whose ways their neighbours
speak little to outsiders but much among themselves.</p>
</blockquote>

<p>By <a href="http://www.bobhobbs.com/files/kr_lovecraft.html">Kernighan, Ritchie, and Lovecraft</a></p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/12/25/paredit-el-comes-to-intellij">Paredit.el Comes to IntelliJ</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-25T20:21:47+01:00" pubdate data-updated="true">Dec 25<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I’ve been working on adding <a href="http://mumble.net/~campbell/emacs/paredit.el">paredit.el</a> like structural editing to
the next version of the <a href="http://plugins.intellij.net/plugin/?id=4050">La Clojure</a> plugin for <a href="http://www.jetbrains.com/idea/index.html">Intellij IDEA</a>.
IDEA already does most of the paren matching stuff (automatically
inserting a closing paren when you type an opening paren and so on). So
far I’ve got the basic barf and slurp commands working, and splicing, as
you can see in the screenshot below:</p>

<p><img src="/images/2009/12/idea-slurp-and-barf.png" /></p>

<p>The next step is
probably to make IDEA’s expand selection code be a little smarter in the
face of s-expressions. In related news: I found a good <a href="http://www.slideshare.net/mudphone/paredit-preso">introduction to paredit.el</a> on <a href="http://www.slideshare.net/">SlideShare</a> which may be of interest. I’ll try
to get the guys at IntelliJ to push out a new version of the plugin
after the 9.0.1 release is out (it’s in beta now).</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/12/17/clojure-purists">Clojure Purists?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-17T14:39:25+01:00" pubdate data-updated="true">Dec 17<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I’ve been following <a href="http://www.tbray.org/ongoing/">Tim Bray</a>’s excellent <a href="http://www.tbray.org/ongoing/When/200x/2009/09/27/Concur-dot-next">Concur.next</a> article series covering approaches to concurrency in various languages, and currently (no pun intended!) covering Clojure. The <a href="http://www.tbray.org/ongoing/When/200x/2009/12/15/Osborne-WF2-Clojure">latest article</a> talks about a super efficient log parsing <a href="http://meshy.org/2009/12/13/widefinder-2-with-clojure.html">implementation</a> done by <a href="http://meshy.org/">Alex Osborne</a> an includes the following comment:</p>

<blockquote>
  <p>Lots of the performance wins come from dipping into Java-land (AtomicLongs, LinkedBlockingQueue), which is perfectly OK, but a Clojure purist would probably see those occasions as maybe highlighting gaps in that language’s coverage.</p>
</blockquote>

<p>I’d take issue with that, one of the real strengths of Clojure it that it has easy and fast access to the whole Java ecosystem. As <a href="http://clojure.org/jvm\_hosted">Rich says</a>:</p>

<blockquote>
  <p>Clojure is designed to be a hosted language, sharing the JVM type system, GC, threads etc. It compiles all functions to JVM bytecode. Clojure is a great Java library consumer, offering the dot-target-member notation for calls to Java.</p>
</blockquote>

<p>That seems pretty clear to me. I wonder if the people claiming to be Clojure purists are all coming from a Lisp background rather than the Java world?</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/12/07/clojure-evaluation">Clojure Evaluation</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-12-07T17:44:50+01:00" pubdate data-updated="true">Dec 7<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I’ve been loking at the early-access version of <a href="http://www.manning.com/">Manning</a>’s
forthcoming <a href="http://www.manning.com/rathore/">Clojure in Action</a> book as well as some of the
<a href="http://www.manning-sandbox.com/thread.jspa?threadID=35150&amp;tstart=0">criticism</a> of it. One of the complaints is that the current drafts
describe macros as a run-time concept and that this is wrong. The
confusion arises from the fact that <a href="http://clojure.org/">Clojure</a> (and Lisps in general)
don’t follow the same path from source to execution as a more
conventional programming languages like C and Java. I’ll compare four
different languages to see how they differ: C, Java, a traditional Lisp
compiler, and Clojure.</p>

<h3 id="c-like-languages">C Like Languages</h3>

<p><img src="/images/2009/12/c-compilation-stages.png" /></p>

<p>This is what most people
are used to, the traditional compiled language. Here, source code is
read in and then parsed (this is normally broken out into multiple
stages, e.g. a separate lexing stage, but for our purposes we can gloss
over these details). The parser emits some form of intermediate
representation, usually an abstract syntax tree (AST), this is then used
by the compiler to generate executable code.</p>

<p>Again, this
potentially glosses over some details: optimizers can world on the
intermediate representation for example, or the compiler could require a
separate linking stage to generate an executable. For our purposes
though this is sufficient: we go from source to AST to executable. Also,
it could be argued that the C pre-processor operates on the source code
before the parser sees it, but in practice the C macros system is so
primitive it doesn’t really warrant being called out as a separate
stage.</p>

<h3 id="java-like-languages">Java Like Languages</h3>

<p><img src="/images/2009/12/java-compilation-stages.png" /></p>

<p>The Java like
languages differ from C in that they run on top of a virtual machine
rather than being executed directly by the OS; as a reult their compiler
emits ‘bytecode’ rather than a finished executable. This bytecode is
then executed by the virtual machine. In all modern desktop and server
virtual machines this is means just in time compiling the bytecode down
to native machine code.</p>

<h3 id="traditional-lisps">Traditional Lisps</h3>

<p><img src="/images/2009/12/lisp-compilation-stages.png" /></p>

<p>The Lisp view of things
is a little different; it’s more complicated but also more powerful. The
first thing to note is that Lisp code is already basically in the form
of an AST - there is no (or not much) syntax getting in the way. Next,
there are 2 types of macros which are applied to Lisp code: macros and
reader macros. I’ll duscuss them in the opposite order to the way they
are applied…</p>

<p>The standard
type of Lisp macros are what most people rave about when extolling the
virtues of the language: these are chunks of code that are executed
after the source has been loaded into an AST (remember, Lisp source code
is basically in this form already, so this just involves moving from a
textual representation to something that the Lisp runtime can work
with). If a node in the AST is a macro then it is evaluated as the code
is loaded and the result of the evaluation is used to <em>replace the
macro node in the AST</em>.</p>

<p>Stop and think about that for a minute - this
happens <em>before</em> the code is evaluated by the regular Lisp runtime,
but yet at this point you already have access to the full Lisp
programming language. All of this means that you can do some
<a href="http://weitz.de/macros.lisp">pretty</a> <a href="http://brierwooddesign.com/2009/2/12/fun-with-lisp-macros">cool</a> <a href="http://www.paulgraham.com/avg.html">tricks</a>: how about writing your own control
constructs? Writing a DSL compiler? Logging constructs that have
<em>zero</em> runtime overhead when not used (but that can be switched on and
off by users of the program, unlike <code>#define DEBUG 0</code> in C)?</p>

<p>The
second, and much less common, type of macro is the <em>reader macro</em>.
Reader macros operate on the character stream as it is read in, before
the AST is constructed. Basically, when the reader sees a specific
character (usually <code>#</code>) it then looks at the next character and uses that
as a key into a table of functions (the read table) that tell it how to
handle future input. Using reader macros it’s possible to create DSLs
that don’t use s-expression syntax (s-expressions are the paren enclosed
lists that Lisp is (in)famous for); or do something as simple as
allowing the use of brackets to <a href="http://www.psg.com/~dlamkins/sl/chapter03-12.html">write quoted lists</a> without needing
an explicit quote (i.e. writing <code>[1 2 3]</code> instead of <code>'(1 2 3)</code>).</p>

<p>Only once all of this has finished is a traditional lisp ready to let
it’s compiler go to work turning the (now macro-free) AST into
executable code.</p>

<h3 id="clojure">Clojure</h3>

<p>Clojure is very similar to the
traditional Lisp model, with two main differences. The first difference
is the fact that, like Java, the output is bytecode which is then loaded
and executed by a standard Java virtual machine.</p>

<p>The second difference
is that while Clojure does have <a href="http://clojure.org/reader#toc1">reader macros</a>, the read table
isn’t exposed to user programs; that is, while it operates in the same
way as a traditional Lisp there is no way for user code to alter the
behaviour of the reader. This is probably good thing as Clojure includes
a relatively large number of predefined reader macros including a
literal syntax for lists, sets, and maps, as well as lambda-expressions
(anonymous functions) and metadata.</p>

<h3 id="summary">Summary</h3>

<p>C and Java like
languages have a huge amount of syntax baked in, but don’r provide any
way to modify this or to manipulate the program before it is compiled.
Lisp has almost no syntax but provides a mechanism for users to add
their own, and provides a mechanism to manipulate programs before they
are compiled.</p>

<p>Clojure has some syntax (more than other Lisps, but way
less than C/Java/&amp;c.) and provides the same mechanism for program
manipulation as other Lisps. The OmniGraffle file for the images in this
post is <a href="http://ianp.org/images/2009/12/compilation-stages.graffle.gz">available here</a> if anybody is interested.</p>

<p><strong>Update:</strong> this
post is intended to compare traditional C-style languages with Lisps, it
doesn’t cover, for examples, so-called scripting languages such as Perl,
Python, and Ruby.</p>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/page/5/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/page/3/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2012/11/05/stroke-me-gently">Stroke Me Gently</a>
      </li>
    
      <li class="post">
        <a href="/2012/10/31/rearranging-the-apples">Rearranging the Apples</a>
      </li>
    
      <li class="post">
        <a href="/2012/10/30/vlc-versions">VLC Versions</a>
      </li>
    
      <li class="post">
        <a href="/2012/10/30/category-counts-in-octopress-revisited">Category Counts in OctoPress Revisited</a>
      </li>
    
      <li class="post">
        <a href="/2012/10/03/netbeans-rich-client-platform">NetBeans Rich Client Platform</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/ianp">@ianp</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'ianp',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2003&ndash;2012 &mdash; Ian Phillips &mdash;
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a>, <a href="http://www.joyentcloud.com/">Joyent</a>, and too much coffee.</span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'ianpdotorg';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
