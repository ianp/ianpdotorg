
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Digital Magpie</title>
  <meta name="author" content="Ian Phillips">

  
  <meta name="description" content="Ardor3D adds a mechanism for subscribing to events in the scene
graph; things like when a node is added or removed, or has one of it’s
render states &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://ianp.org/page/7/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Digital Magpie" type="application/atom+xml">
  <!--Fonts from Google's Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>


<script type="text/javascript">
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '4fa7e376613f5d2014000195');
    t.src = '//secure.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>




  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Digital Magpie</a></h1>
  
    <h2>Ooh, ooh, look - shiny things!</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:ianp.org" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul role=main-navigation>
  <li><a href="/">Blog</a></li>
  <li><a href="/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/04/21/understanding-event-propagation-in-ardor3d">Understanding Event Propagation in Ardor3D</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-04-21T14:07:50+01:00" pubdate data-updated="true">Apr 21<span>st</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.ardor3d.com/">Ardor3D</a> adds a mechanism for subscribing to events in the scene
graph; things like when a node is added or removed, or has one of it’s
render states or it’s bounding volume altered. The way notifications are
handled is a little confusing at first, as the listener interface
(<code>DirtyEventListener</code>) has a method which takes a <code>Spatial</code> as it’s
first argument; hoever, the spatial is the node in the scene graph on
which the event occurred, it is <em>not</em> the node that the event is fired
from.</p>

<p>By way of example: if there are 2 scene nodes, a <code>Spatial</code> named
‘child’ and a <code>Node</code> named ‘parent’, and the child is attached to the
parent via a call to <code>Node#attachChild(Spatial)</code> then the following
events will be fired (assuming that the child was not already attached
to another node):</p>

<ol>
  <li>from the child: <code>spatialDirty(child, Attached)</code></li>
  <li>
    <p>from the parent: <code>spatialDirty(child, Attached)</code>
if the parent was attached to another node (for example, ‘grandparent’) then this pattern would continue, like so:</p>
  </li>
  <li>from the grandparent: spatialDirty(child, Attached) also, if at any point in this one of the <code>spatialDirty</code> calls returns true, then the event is assumed to have been handled and propagation will stop at that point.</li>
</ol>

<p>What this means in practice is that
if you need to know which node an event is being fired from you cannot
reuse listeners on multiple nodes. For detaching nodes the situation is
a little different: the event propagation starts at the parent node,
with the detached child passed as as the method argument.</p>

<p>Be aware that
the parent will already have been set to <code>null</code> when the event is
fired though, so if you need to be able to do something with the parent
you will need to add distinct listeners to each node of interest.</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/04/10/cool-glass">Cool Glass</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-04-10T12:07:27+01:00" pubdate data-updated="true">Apr 10<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>And not the camera kind for a change… but [this][01] is pretty neat.
[01]: http://sirtified.com/products/hopsidedown/</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/01/17/object-pooling-performance">Object Pooling Performance</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-01-17T16:21:13+00:00" pubdate data-updated="true">Jan 17<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This is an attempt to compare the performance of various object reuse
strategies for <a href="http://www.jmonkeyengine.com/">JMonkeyEngine</a> (and, indirectly, <a href="http://www.ardor3d.com/">Ardor3D</a>). See
<a href="http://www.jmonkeyengine.com/jmeforum/index.php?topic=10146.0">this JME forum topic</a> for background info. Also, it’s worth bearing
in mind that the main driver for this is to reduce GC pauses, not to
improve throughput (this is mentioned in the forum topic).</p>

<p>This is
timings from my initial object pooling implementation using 1 thread
(all timings throughout this article are in milliseconds):</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">1793, 2109, 1485, 1418, 1414, 1592, 1675, 2206, 1768, 1685</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>An interesting
(although unrelated to the topic at hand) thing to note here is that
it’s pretty easy to spot when hotspot kicked in, although the jump in
timings between runs 4 and 5 bears investigating further and the slow
run (run 7) is certainly a worry. Run 7 seems to be consistently slow
and turning on <code>-verbose:gc</code> doesn’t reveal anything here. This is
timings from my object pooling implementation using 2 threads, note here
that this is each thread doing a fixed chunk of work, not a fixed amount
of work shared between threads (i.e. 2x number of threads = 2x amount of
work):</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">2234, 2965, 1796, 1830, 2029, 2145, 2105, 2242, 2214, 2247</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>So the timings are higher although not twice as high as might be expected,
this is probably due to that fact that my laptop has a 2-core CPU. Now
let’s look at the timings from the same with 10 threads:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">8869, 9814, 9203, 8966, 9182, 8973, 9176, 9166, 9358, 9182</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>Yep, about 5x the time as
the 2 thread runs. Now let’s see how the existing implementation
compares to these. OK, so now we have an idea how the thread local and
pooling based implementation performs, let’s have a look at the existing
implementation to give us a baseline to compare to. This is timings from
the existing implementation using 1 thread:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">1501, 1469, 1379, 1374, 1471, 1553, 1553, 1589, 1652, 1547</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Well, that’s quite a bit faster for a
single thread, although not an order magnitude type difference, and it
didn’t use any locking as it’s running from a single thread, a more
realistic implementation would need to have the locks in place in case
future code tried to use multiple threads. Let’s have a look at 2
threads now:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">3038, 2906, 2797, 3140, 3120, 3124, 3143, 3179, 3340, 3352</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Oops! This is about what we’d expect to see, a doubling of the
amount of work doubles the amount of time needed (as the quaternion
class is now a shared resource). And 10 threads:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">15538, 16145</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>OK, I got bored of waiting after 2 runs! But it’s clear to see that it’s much
slower. Finally, based on suggestions from vear and also looking at the
code used in the <a href="http://www.javolution.com/">Javolution</a> library (a set of real-time Java
classes), I decided to try a version that reduced the number of thread
local look-ups needed, this comes at the cost of not providing a single
reusable <code>ObjectPool</code> class, but as that class is pretty trivial
anyway it’s no great loss leaving it out of the framework.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line"> 1 thread : 1189, 1149, 1096, 1229, 1261, 1506, 1352, 1415, 1295, 1424
</span><span class="line"> 2 threads: 1644, 1582, 1799, 1640, 1584, 1587, 1766, 1658, 1624, 1806
</span><span class="line">10 threads: 6853, 7037, 7469, 7549, 7438, 7851, 7748, 7769, 7661, 7703</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Wow! it’s pretty clear that the pooled approach is much
faster and that the cost of performing the thread local look-up is
fairly significant. Interestingly I also tried this using raw arrays
instead of <code>ArrayList</code>s and it was much slower, I can only surmise
that because <code>ArrayList</code> is so heavily used throughout Java it gets
insanely optimised by hotspot. As a side note, here’s my Java
environment:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="sh"><span class="line">~/tmp/perftests<span class="nv">$ </span>uname -a
</span><span class="line">Darwin Kernel Version 9.6.0: Mon Nov 24 17:37:00 PST 2008;
</span><span class="line">root:xnu-1228.9.59~1/RELEASE_I386
</span><span class="line">~/tmp/perftests<span class="nv">$ </span>java -version
</span><span class="line">java version <span class="s2">&quot;1.6.0_07&quot;</span>
</span><span class="line">Java<span class="o">(</span>TM<span class="o">)</span> SE Runtime Environment <span class="o">(</span>build 1.6.0_07-b06-153<span class="o">)</span>
</span><span class="line">Java HotSpot<span class="o">(</span>TM<span class="o">)</span> 64-Bit Server VM <span class="o">(</span>build 1.6.0_07-b06-57, mixed mode<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>And the code used for these tests is available <a href="http://ianp.org/2009/01/jme-thread-local-performance.tgz">here</a>. I also tried
this using 1.5 with both the server and client VMs, the 1.5 server VM is
noticeably slower and the 1.5 client VM is frankly a dog, it was 5-6
times slower than the 1.6 times given here.</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/12/19/two-articles-about-online-games">Two Articles About Online Games</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-12-19T14:25:40+00:00" pubdate data-updated="true">Dec 19<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The <a href="http://www.infoq.com/presentations/Second-Life-Ian-Wilkes">first</a>, over at <a href="http://www.infoq.com/">InfoQ</a>, is a talk given by one of the
<a href="http://lindenlab.com/">Linden Labs</a> guys about the architecture of <a href="http://secondlife.com/">Second Life</a>. The
<a href="http://arstechnica.com/news.ars/post/20081219-online-buzz-key-to-creating-long-term-game-revenue.html">other</a> is at <a href="http://arstechnica.com/">Ars Technica</a> and looks at some of the numbers
surrounding the business of gaming.</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/07/31/infoq-presentations">InfoQ Presentations</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-07-31T08:19:56+01:00" pubdate data-updated="true">Jul 31<span>st</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.infoq.com/">InfoQ</a> are one of my favourite tech information sites anyway and the
signal to noise ratio there is normally pretty high, they’ve got 3 great
new presentations out today:</p>

<ul>
  <li>
    <p>in <a href="http://www.infoq.com/news/2008/07/Developing-Expertise-Dave-Thomas">Herding Racehorses, Racing Sheep</a>, Dave Thomas talks about the problems of treating developers
as interchangeable cogs (or <em>fungible resources</em>, as the project
management crowd would say). Some great ideas for bringing new team
members up to speed quickly (about 18 minutes in);</p>
  </li>
  <li>
    <p>in <a href="http://www.infoq.com/news/2008/07/presentation-botch-scalability">The Top 10 Ways to Botch Enterprise Java Scalability and Reliability</a>, Cameron
Purdy of Oracle talks about scaling Java. Obviously it’s not an
impartial view but his points are good ones and it’s an interesting
talk;</p>
  </li>
  <li>
    <p>in <a href="http://www.infoq.com/articles/ddd-evolving-architecture">Domain-Driven Design in an Evolving Architecture</a>, Mat
Wall and Nik Silver talk about their experiences applying DDD at the
<a href="http://guardian.co.uk/">Guardian’s web site</a>, it covers why they selected DDD as a method as
well as the benefits that they feel it brought. I’ve heard them talk
about this before, on <a href="http://se-radio.net/">SE Radio</a>, and to be honest, it worked better
in that format I thought - the written version here needs to be edited
down to about half it’s current length;</p>
  </li>
  <li>
    <p>finally, <a href="http://www.infoq.com/news/2008/07/Architecture-Reviews-Brock">Rebecca Wirfs-Brock talks about</a> the benefits of, and problems of conducting,
architectural reviews. I’ve listened to some of this before as Rebecca
did an <a href="http://www.se-radio.net/podcast/2008-04/episode-93-lessons-learned-architecture-reviews-rebecca-wirfsbrock">interview</a> with <a href="http://se-radio.net/">SE Radio</a> a while back, but this is good
for people who haven’t heard her talk before.</p>
  </li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/07/30/turning-off-apple-data-detectors-in-mail">Turning Off Apple Data Detectors in Mail</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-07-30T03:48:51+01:00" pubdate data-updated="true">Jul 30<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Apparently <a href="http://mjtsai.com/blog/2008/07/29/turning-off-apple-data-detectors-in-mail/">Michael Tsai doesn’t like</a> the data detectors feature in
Leopard. Personally I <em>love</em> it. For those of you who don’t know, data
detectors is a feature that adds smart links to chunks of text based on
what it thinks the text describes. For example, one feature that I use
all the time in Mail is the detector that turns any date or time into a
link allowing you to add it to iCal as an event.</p>

<p>The really neat thing
about it is how it can scan the entire post to come up with information
to fill in about the event – even looking at different regions of text
scattered throughout a mail. It’s pretty neat and is exactly the type of
thing that <a href="http://wilshipley.com/">Wil Shipley</a> is talking about <a href="http://www.viddler.com/explore/rentzsch/videos/4/">here</a> when he mentions
adding features to your apps that constantly surprise users in a good
way (I’ve seen designers from BMW talk about the same thing in the
context of styling their car interiors).</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/05/25/sourceforge-annoyances">Sourceforge Annoyances</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-05-25T20:28:23+01:00" pubdate data-updated="true">May 25<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.sourceforge.net/">That site</a> gets worse and worse. I can live with the fact that
corporate IT departments can behave like petit-Hilters with their
ridiculous password policies, but now SF has started to do the same. For
fuck’s sake, just let me pick a password and keep it, it’s not like the
world is going to end if somebody gets my SF login details.</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/05/21/layout">Layout</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-05-21T19:09:02+01:00" pubdate data-updated="true">May 21<span>st</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Hmmm, I need to something about the site layout if I’m going to include
images like that.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/05/21/has-amazon-gone-crazy">Has Amazon Gone Crazy?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-05-21T19:03:47+01:00" pubdate data-updated="true">May 21<span>st</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I’ve just been looking at getting a copy of the newly released Cocoa
Programming 3rd Edition (tip o’ the hat to <a href="http://theocacao.com/document.page/571">Scott Stevenson</a>) and, as
the link from there is to the <a href="http://www.amazon.com/dp/0321503619">U.S. Amazon site</a> I saw the price
there:</p>

<p><img src="/images/2008/05/21/cocoa-programming-us.png" /></p>

<p>then going to my local <a href="http://www.amazon.co.uk/dp/0321503619">U.K. based Amazon page</a> to place an order and:</p>

<p><img src="/images/2008/05/21/cocoa-programming-uk.png" /></p>

<p>well, what
the fuck is that all about exactly? Check out the <a href="http://www.oanda.com/convert/classic">conversion rates</a>:</p>

<blockquote>
  <p>Wednesday, May 21, 2008
28.79 British Pound = 57.526 US Dollar
28.79 US Dollar (USD) = 14.991 British Pound (GBP)
Interbank rate +/- 2%</p>
</blockquote>

<p>That’s getting on for sixty bucks! almost twice the price of the US site. That’s just fucking ridiculous.</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/03/30/plastic-bag-recycling">Plastic Bag Recycling</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2008-03-30T00:05:28+00:00" pubdate data-updated="true">Mar 30<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>You’ve got to love <a href="http://nedbatchelder.com/blog/200803/street_bag_animals.html">this!</a></p>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/page/8/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/page/6/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2012/12/17/i-remain-a-free-man">I Remain a Free Man</a>
      </li>
    
      <li class="post">
        <a href="/2012/11/05/stroke-me-gently">Stroke Me Gently</a>
      </li>
    
      <li class="post">
        <a href="/2012/10/31/rearranging-the-apples">Rearranging the Apples</a>
      </li>
    
      <li class="post">
        <a href="/2012/10/30/vlc-versions">VLC Versions</a>
      </li>
    
      <li class="post">
        <a href="/2012/10/30/category-counts-in-octopress-revisited">Category Counts in OctoPress Revisited</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/ianp">@ianp</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'ianp',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2003&ndash;2012 &mdash; Ian Phillips &mdash;
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a>, <a href="http://github.com/">GitHub</a>, and too much coffee.</span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'ianpdotorg';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
